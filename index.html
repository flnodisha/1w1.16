<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PNG PDF Viewer</title>

  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    .viewer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .viewer-container img {
      width: 100%;
      max-width: 800px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    /* Share Button */
    #shareBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      cursor: pointer;
    }

    #shareBtn:hover {
      background-color: #218838;
    }

    /* Loader overlay */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      position: absolute;
    }

    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }

    .loading {
      position: fixed;
      bottom: 40px;
      right: 40px;
      z-index: 10000;
    }
  </style>
</head>
<body>

  <div class="viewer-container" id="book-pages">
    <img src="page1.webp" alt="Page 1">
    <img src="page2.webp" alt="Page 2">
    <img src="page3.webp" alt="Page 3">
    <img src="page4.webp" alt="Page 4">
  </div>

  <!-- Share button -->
  <button id="shareBtn" onclick="handleShare()">
    <i class="fas fa-share-alt"></i>
  </button>

  <!-- Spinner container -->
  <div id="spinnerContainer" class="loading" style="display: none;">
    <div class="spinner"></div>
  </div>

  <script>
    async function handleShare() {
      const spinner = document.getElementById('spinnerContainer');
      spinner.style.display = 'block';

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const images = document.querySelectorAll('#book-pages img');

      for (let i = 0; i < images.length; i++) {
        const img = images[i];

        if (!img.complete) await new Promise(resolve => img.onload = resolve);

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        ctx.drawImage(img, 0, 0);

        const imgData = canvas.toDataURL('image/jpeg');
        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
        canvas.remove();
      }

      // Output PDF as blob URL
      const pdfBlob = pdf.output('blob');

      // Save temporarily in browser
      const fileReader = new FileReader();
      fileReader.onloadend = function () {
        const base64data = fileReader.result.split(',')[1];

        // Now pass base64 PDF data to Android via JS interface
        if (window.AndroidInterface && AndroidInterface.sharePDFBase64) {
          AndroidInterface.sharePDFBase64(base64data, "my-book.pdf");
        } else {
          alert("Sharing not supported in this browser.");
        }

        spinner.style.display = 'none';
      };

      fileReader.readAsDataURL(pdfBlob);
    }
  </script>
</body>
</html>
